

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>geogenie.plotting.plotting &mdash; GeoGenIE 1.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=292eb321"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            GeoGenIE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">GeoGenIE Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../geogenie.html">geogenie package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">GeoGenIE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">geogenie.plotting.plotting</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for geogenie.plotting.plotting</h1><div class="highlight"><pre>
<span></span><span class="c1"># Standard library imports</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Third-party imports</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;Agg&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">kneed</span> <span class="kn">import</span> <span class="n">KneeLocator</span>
<span class="kn">from</span> <span class="nn">optuna</span> <span class="kn">import</span> <span class="n">exceptions</span> <span class="k">as</span> <span class="n">optuna_exceptions</span>
<span class="kn">from</span> <span class="nn">optuna</span> <span class="kn">import</span> <span class="n">visualization</span>
<span class="kn">from</span> <span class="nn">pykrige.ok</span> <span class="kn">import</span> <span class="n">OrdinaryKriging</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gamma</span>
<span class="kn">from</span> <span class="nn">sklearn.exceptions</span> <span class="kn">import</span> <span class="n">ConvergenceWarning</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>

<span class="c1"># Local application imports</span>
<span class="kn">from</span> <span class="nn">geogenie.samplers.samplers</span> <span class="kn">import</span> <span class="n">GeographicDensitySampler</span>
<span class="kn">from</span> <span class="nn">geogenie.utils.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">geogenie.utils.spatial_data_processors</span> <span class="kn">import</span> <span class="n">SpatialDataProcessor</span>
<span class="kn">from</span> <span class="nn">geogenie.utils.utils</span> <span class="kn">import</span> <span class="n">time_limit</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">ConvergenceWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">optuna_exceptions</span><span class="o">.</span><span class="n">ExperimentalWarning</span><span class="p">)</span>


<div class="viewcode-block" id="PlotGenIE">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE">[docs]</a>
<span class="k">class</span> <span class="nc">PlotGenIE</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class dedicated to generating and managing plots for data visualization.</span>

<span class="sd">    This class is designed to generate a variety of plots for visualizing data, including geographical data, model training times, and model performance metrics. It provides methods for creating plots, saving them to disk, and displaying them inline.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        device (str): The device used for plotting, typically &#39;cpu&#39; or &#39;cuda&#39;.</span>
<span class="sd">        output_dir (str): The directory where plots will be saved.</span>
<span class="sd">        prefix (str): A prefix added to the names of saved plot files.</span>
<span class="sd">        basemap_fips (str): FIPS code for base map.</span>
<span class="sd">        basemap_highlights (list): List of counties to highlight gray on base map.</span>
<span class="sd">        show_plots (bool): Flag to determine if plots should be displayed inline. Defaults to False.</span>
<span class="sd">        fontsize (int): Font size used in plots. Defaults to 18.</span>
<span class="sd">        filetype (str): File type/format</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">device</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">,</span>
        <span class="n">prefix</span><span class="p">,</span>
        <span class="n">basemap_fips</span><span class="p">,</span>
        <span class="n">basemap_highlights</span><span class="p">,</span>
        <span class="n">url</span><span class="p">,</span>
        <span class="n">show_plots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
        <span class="n">filetype</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">remove_splines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A class dedicated to generating and managing plots for data visualization.</span>

<span class="sd">        This class is designed to generate a variety of plots for visualizing data, including geographical data, model training times, and model performance metrics. It provides methods for creating plots, saving them to disk, and displaying them inline.</span>

<span class="sd">        Args:</span>
<span class="sd">            device (str): The device used for plotting, typically &#39;cpu&#39; or &#39;cuda&#39;.</span>
<span class="sd">            output_dir (str): The directory where plots will be saved.</span>
<span class="sd">            prefix (str): A prefix added to the names of saved plot files.</span>
<span class="sd">            basemap_fips (str): FIPS code for base map.</span>
<span class="sd">            basemap_highlights (list): List of counties to highlight gray on base map.</span>
<span class="sd">            url (str): URL from which to download basemap.</span>
<span class="sd">            show_plots (bool, optional): Flag to determine if plots should be displayed inline. Defaults to False.</span>
<span class="sd">            fontsize (int, optional): Font size used in plots. Defaults to 18.</span>
<span class="sd">            filetype (str, optional): File type/format for saving plots. Defaults to &#39;png&#39;.</span>
<span class="sd">            dpi (int, optional): Dots per inch, specifying the resolution of plots. Defaults to 300.</span>
<span class="sd">            remove_splines (bool, optional): If True, then remove splines from map plots. If False, then only top and right splines are included. Defaults to False.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            device (str): The device used for plotting, typically &#39;cpu&#39; or &#39;cuda&#39;.</span>
<span class="sd">            output_dir (str): The directory where plots will be saved.</span>
<span class="sd">            prefix (str): A prefix added to the names of saved plot files.</span>
<span class="sd">            basemap_fips (str): FIPS code for base map.</span>
<span class="sd">            basemap_highlights (list): List of counties to highlight gray on base map.</span>
<span class="sd">            show_plots (bool): Flag to determine if plots should be displayed inline. Defaults to False.</span>
<span class="sd">            fontsize (int): Font size used in plots. Defaults to 18.</span>
<span class="sd">            filetype (str): File type/format for saving plots. Defaults to &#39;png&#39;.</span>
<span class="sd">            dpi (int): Dots per inch, specifying the resolution of plots. Defaults to 300.</span>
<span class="sd">            outbasepath (Path): Base path for saving plots, constructed from output_dir, prefix, and filetype.</span>
<span class="sd">            logger (Logger): Logger for logging information and errors.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This class is designed to work with matplotlib and seaborn for generating plots.</span>
<span class="sd">            - Global matplotlib settings are adjusted according to the specified fontsize and dpi.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basemap_fips</span> <span class="o">=</span> <span class="n">basemap_fips</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basemap_highlights</span> <span class="o">=</span> <span class="n">basemap_highlights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="n">show_plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span> <span class="o">=</span> <span class="n">filetype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_splines</span> <span class="o">=</span> <span class="n">remove_splines</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="c1"># Initialize SpatialDataProcessor instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">SpatialDataProcessor</span><span class="p">(</span>
            <span class="n">output_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">basemap_fips</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basemap_fips</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">extract_basemap_path_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;STATEFP&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;&#39;shapefile does not contain &#39;STATEFP&#39; columns. cannot subset shapefile by FIPS code.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basemap_fips</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basemap_fips</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basemap_fips</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basemap_fips</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basemap_fips</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap_fips</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="p">[</span><span class="s2">&quot;STATEFP&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap_fips</span><span class="p">]</span>

        <span class="c1"># Adjust matplotlib settings globally.</span>
        <span class="n">sizes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;axes.labelsize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="s2">&quot;axes.titlesize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="s2">&quot;axes.spines.right&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;axes.spines.top&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;xtick.top&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;ytick.right&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;figure.titlesize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="s2">&quot;figure.labelsize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="s2">&quot;xtick.labelsize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="s2">&quot;ytick.labelsize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="s2">&quot;legend.fontsize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="s2">&quot;legend.title_fontsize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="s2">&quot;legend.frameon&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;legend.markerscale&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="s2">&quot;figure.dpi&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span>
            <span class="s2">&quot;savefig.dpi&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="n">rc</span><span class="o">=</span><span class="n">sizes</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span>

<div class="viewcode-block" id="PlotGenIE.plot_times">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_times">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolling_avgs</span><span class="p">,</span> <span class="n">rolling_stds</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot model training times.</span>

<span class="sd">        This method generates a plot showing the rolling average of model training times over bootstrap replicates. It also includes the standard deviation of training times to provide insight into the variability of training durations.</span>

<span class="sd">        Args:</span>
<span class="sd">            rolling_avgs (list): List of rolling average training times.</span>
<span class="sd">            rolling_stds (list): List of rolling standard deviations of training times.</span>
<span class="sd">            filename (str): Name of the file to save the plot.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This method visualizes the time taken to train models over bootstrap replicates.</span>
<span class="sd">            - It uses a line plot to show the rolling average of training times and includes a shaded region to represent the standard deviation of training times.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rolling_avgs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rolling Average (Bootstrap Time)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rolling_avgs</span><span class="p">)),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rolling_avgs</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rolling_stds</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rolling_avgs</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rolling_stds</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Standard Deviation (Bootstrap Time)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Bootstrap Replicate&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Duration (s)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
            <span class="s2">&quot;Rolling Average Time of per-Bootstrap Model Training&quot;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="p">)</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_smote_bins">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_smote_bins">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_smote_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">df_orig</span><span class="p">,</span> <span class="n">bins_orig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots scatter plots before and after oversampling.</span>

<span class="sd">        This method visualizes the effect of oversampling on the data distribution. It creates a subplot with two scatter plots: one showing the original data and the other showing the data after SMOTE has been applied.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pandas DataFrame): DataFrame containing the data after SMOTE oversampling.</span>
<span class="sd">            bins (array-like): Array of bin labels for the data after SMOTE.</span>
<span class="sd">            df_orig (pandas DataFrame): DataFrame containing the original data before SMOTE.</span>
<span class="sd">            bins_orig (array-like): Array of original bin labels before SMOTE.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This function visually compares the geographical distribution of data before and after SMOTE.</span>
<span class="sd">            - Each plot shows data points colored by their bin labels, providing insight into the oversampling process.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_smote_scatter</span><span class="p">(</span>
            <span class="n">df_orig</span><span class="p">,</span> <span class="n">bins_orig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Before Simulations&quot;</span><span class="p">,</span> <span class="s2">&quot;upper right&quot;</span>
        <span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_smote_scatter</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;After Simulations&quot;</span><span class="p">,</span> <span class="s2">&quot;upper left&quot;</span>
        <span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_spines</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_oversampling_scatter.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE._remove_spines">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE._remove_spines">[docs]</a>
    <span class="k">def</span> <span class="nf">_remove_spines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove spines from a plot.</span>

<span class="sd">        This method removes spines from a plot, ensuring that only the top and right spines are included.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax (matplotlib.axes.Axes): The matplotlib Axes object where the plot will be drawn.</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.axes.Axes: The Axes object with spines removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_splines</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([],</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([],</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="PlotGenIE._plot_smote_scatter">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE._plot_smote_scatter">[docs]</a>
    <span class="k">def</span> <span class="nf">_plot_smote_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a scatter plot for visualizing data points with their associated bin labels.</span>

<span class="sd">        This method is used internally by `plot_smote_bins` to generate individual scatter plots.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pandas DataFrame): DataFrame containing the data to be plotted.</span>
<span class="sd">            bins (array-like): Array of bin labels for the data.</span>
<span class="sd">            ax (matplotlib.axes.Axes): The matplotlib Axes object where the plot will be drawn.</span>
<span class="sd">            title (str): Title of the scatter plot.</span>
<span class="sd">            loc (str): Location of the legend in the plot.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This function is a helper method and is not intended to be called directly.</span>
<span class="sd">            - It adds a scatter plot to the provided Axes object, with data points colored by their bin labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bins</span>
        <span class="n">n_bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sample_weights&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Ensures correct CRS.</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_geopandas</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Plot the basemap</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;State/ County Lines&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">gdf</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="s2">&quot;size&quot;</span><span class="p">,</span>
            <span class="n">sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
            <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set2&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="n">anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="k">if</span> <span class="n">loc</span> <span class="o">==</span> <span class="s2">&quot;upper left&quot;</span> <span class="k">else</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># extract the existing handles and labels</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>

        <span class="c1"># slice the appropriate section of l and h to include in the legend</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">n_bins</span><span class="p">:],</span> <span class="n">l</span><span class="p">[</span><span class="n">n_bins</span><span class="p">:],</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_history">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_history">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">,</span> <span class="n">val_loss</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Automatically plot training and validation loss with scaling.</span>

<span class="sd">        This method generates a plot showing the training and validation loss over epochs. It automatically scales the y-axis to ensure that the plot is visually appealing.</span>

<span class="sd">        Args:</span>
<span class="sd">            train_loss (list): List of training loss values.</span>
<span class="sd">            val_loss (list): List of validation loss values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Training Loss&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val_loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Validation Loss&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Training and Validation Loss Over Epochs&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Loss&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_train_history.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE.make_optuna_plots">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.make_optuna_plots">[docs]</a>
    <span class="k">def</span> <span class="nf">make_optuna_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize Optuna search using built-in Optuna plotting methods.</span>

<span class="sd">        This method generates a series of plots to visualize the results of an Optuna hyperparameter search.</span>

<span class="sd">        Args:</span>
<span class="sd">            study (optuna.study): Optuna study to plot.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: If an error occurs during the plot generation process.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">visualization</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Could not make plots because plotly and kaleido are not installed.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">importance_fig</span> <span class="o">=</span> <span class="n">visualization</span><span class="o">.</span><span class="n">plot_param_importances</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
            <span class="n">importance_fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_param_importances.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="n">edf_fig</span> <span class="o">=</span> <span class="n">visualization</span><span class="o">.</span><span class="n">plot_edf</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s2">&quot;Location Error&quot;</span><span class="p">)</span>
            <span class="n">edf_fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_edf.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">par_fig</span> <span class="o">=</span> <span class="n">visualization</span><span class="o">.</span><span class="n">plot_parallel_coordinate</span><span class="p">(</span>
                <span class="n">study</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s2">&quot;Location Error&quot;</span>
            <span class="p">)</span>

            <span class="n">par_fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_parallel_coordinates.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="n">slice_fig</span> <span class="o">=</span> <span class="n">visualization</span><span class="o">.</span><span class="n">plot_slice</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s2">&quot;Location Error&quot;</span><span class="p">)</span>
            <span class="n">slice_fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_slices.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">tl_fig</span> <span class="o">=</span> <span class="n">visualization</span><span class="o">.</span><span class="n">plot_timeline</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
            <span class="n">tl_fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_timeline.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">rank_fig</span> <span class="o">=</span> <span class="n">visualization</span><span class="o">.</span><span class="n">plot_rank</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s2">&quot;Location Error&quot;</span><span class="p">)</span>
            <span class="n">rank_fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_rank.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">time_limit</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
                    <span class="n">ctr_fig</span> <span class="o">=</span> <span class="n">visualization</span><span class="o">.</span><span class="n">plot_contour</span><span class="p">(</span>
                        <span class="n">study</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s2">&quot;Location Error&quot;</span>
                    <span class="p">)</span>
                    <span class="n">ctr_fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_contour.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="n">TimeoutException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Generation of Optuna contour plot timed out.&quot;</span><span class="p">)</span>

            <span class="n">hist_fig</span> <span class="o">=</span> <span class="n">visualization</span><span class="o">.</span><span class="n">plot_optimization_history</span><span class="p">(</span>
                <span class="n">study</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s2">&quot;Location Error&quot;</span>
            <span class="p">)</span>

            <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_opt_history.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="n">hist_fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outfile</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not create Optuna plot: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_bootstrap_aggregates">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_bootstrap_aggregates">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_bootstrap_aggregates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make KDE and bar plots with bootstrap distributions and CIs.</span>

<span class="sd">        This method creates two plots: one with kernel density estimates (KDEs) of the bootstrap distributions for each metric, and another with box plots showing the distribution of bootstrap samples for each metric.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): The DataFrame containing the bootstrap samples for each metric.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>

        <span class="n">df_errordist</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;mean_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;median_dist&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">df_errordist</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;mean_dist&quot;</span><span class="p">:</span> <span class="s2">&quot;Mean Haversine Error (km)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;median_dist&quot;</span><span class="p">:</span> <span class="s2">&quot;Median Haversine Error (km)&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">df_corr</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
            <span class="p">[</span>
                <span class="s2">&quot;pearson_corr_longitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pearson_corr_latitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;spearman_corr_longitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;spearman_corr_latitude&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">df_corr</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;pearson_corr_longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;$R^2$ (Longitude)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pearson_corr_latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;$R^2$ (Latitude)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;spearman_corr_longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;Rho (Longitude)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;spearman_corr_latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;Rho (Latitude)&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">df_melt_errordist</span> <span class="o">=</span> <span class="n">df_errordist</span><span class="o">.</span><span class="n">melt</span><span class="p">()</span>
        <span class="n">df_melt_corr</span> <span class="o">=</span> <span class="n">df_corr</span><span class="o">.</span><span class="n">melt</span><span class="p">()</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">df_melt_errordist</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set2&quot;</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">df_melt_corr</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set2&quot;</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Distribution of Bootstrapped Error&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Distance Error&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend_</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Metric&quot;</span><span class="p">)</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">move_legend</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.45</span><span class="p">),</span>
            <span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df_melt_errordist</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Distribution of Bootstrapped Error&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Correlation Coefficient&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">move_legend</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.45</span><span class="p">),</span>
            <span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df_melt_corr</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend_</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Metric&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_bootstrap_error_distributions.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">df_melt_errordist</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Dark2&quot;</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">df_melt_corr</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
            <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Dark2&quot;</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Bootstrapped Prediction Error&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Metric&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Prediction Error (km)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">move_legend</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">))</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Bootstrapped Prediction Error&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Metric&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Correlation Coefficient&quot;</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">move_legend</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_bootstrap_error_barplots.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE.update_metric_labels">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.update_metric_labels">[docs]</a>
    <span class="k">def</span> <span class="nf">update_metric_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update metric labels in the dataframe based on specified mappings.</span>

<span class="sd">        This method updates the metric labels in the dataframe based on the mappings provided in the method.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): The dataframe to be updated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The updated dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metric_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mean_dist&quot;</span><span class="p">:</span> <span class="s2">&quot;Mean Error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;median_dist&quot;</span><span class="p">:</span> <span class="s2">&quot;Median Error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stdev_dist&quot;</span><span class="p">:</span> <span class="s2">&quot;StdDev of Error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;percent_within_20km&quot;</span><span class="p">:</span> <span class="s2">&quot;% Samples within 20 km&quot;</span><span class="p">,</span>
            <span class="s2">&quot;percent_within_50km&quot;</span><span class="p">:</span> <span class="s2">&quot;% Samples within 50 km&quot;</span><span class="p">,</span>
            <span class="s2">&quot;percent_within_75km&quot;</span><span class="p">:</span> <span class="s2">&quot;% Samples within 75 km&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mad_haversine&quot;</span><span class="p">:</span> <span class="s2">&quot;Median Absolute Deviation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;coeffecient_of_variation&quot;</span><span class="p">:</span> <span class="s2">&quot;Coefficient of Variation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;percentile_25&quot;</span><span class="p">:</span> <span class="s2">&quot;25th Percentile of Error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;percentile_50&quot;</span><span class="p">:</span> <span class="s2">&quot;50th Percentile of Error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;percentiles_75&quot;</span><span class="p">:</span> <span class="s2">&quot;75th Percentile of Error&quot;</span><span class="p">,</span>  <span class="c1"># typo in original data</span>
            <span class="s2">&quot;pearson_corr_longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;$R^2$ (Longitude)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pearson_corr_latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;$R^2$ (Latitude)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;spearman_corr_longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;Rho (Longitude)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;spearman_corr_latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;Rho (Latitude)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;skewness&quot;</span><span class="p">:</span> <span class="s2">&quot;Skewness&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">original</span><span class="p">,</span> <span class="n">new</span> <span class="ow">in</span> <span class="n">metric_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Metric&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">original</span><span class="p">,</span> <span class="s2">&quot;Metric&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span>

        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="PlotGenIE.update_config_labels">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.update_config_labels">[docs]</a>
    <span class="k">def</span> <span class="nf">update_config_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update config labels in the dataframe based on the file patterns.</span>

<span class="sd">        This method updates the configuration labels in the dataframe based on the file patterns used to generate the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): The dataframe to be updated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The updated dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Mapping of file name starts to corresponding labels</span>
        <span class="n">config_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;locator&quot;</span><span class="p">:</span> <span class="s2">&quot;Locator&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nn_base_unopt&quot;</span><span class="p">:</span> <span class="s2">&quot;GeoGenie Base (Unoptimized)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nn_base_opt&quot;</span><span class="p">:</span> <span class="s2">&quot;GeoGenie Base&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nn_loss_opt&quot;</span><span class="p">:</span> <span class="s2">&quot;GeoGenie + Loss&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nn_sampler_opt&quot;</span><span class="p">:</span> <span class="s2">&quot;GeoGenie + Sampler&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nn_both_opt&quot;</span><span class="p">:</span> <span class="s2">&quot;GeoGenie + Loss + Sampler&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nn_base_smote_opt&quot;</span><span class="p">:</span> <span class="s2">&quot;GeoGenie Base + Interpolation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nn_loss_smote_opt&quot;</span><span class="p">:</span> <span class="s2">&quot;GeoGenie Loss + Interpolation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nn_sampler_smote_opt&quot;</span><span class="p">:</span> <span class="s2">&quot;GeoGenie Sampler + Interpolation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nn_both_smote_opt&quot;</span><span class="p">:</span> <span class="s2">&quot;GeoGenie Loss + Sampler + Interpolation&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Iterate over the mapping and update the dataframe</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">config_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_scatter_samples_map">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_scatter_samples_map">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_scatter_samples_map</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">y_true_train</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">hue1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hue2</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots geographical scatter plots of training and test/validation sample densities.</span>

<span class="sd">        This method creates a subplot with two scatter plots, one showing the density of training samples and the other for test or validation samples.</span>

<span class="sd">        Args:</span>
<span class="sd">            y_true_train (np.array): Array of actual geographical coordinates for the training dataset.</span>
<span class="sd">            y_true (np.array): Array of actual geographical coordinates for the test or validation dataset.</span>
<span class="sd">            dataset (str): Specifies whether the dataset is &#39;test&#39; or &#39;validation&#39;.</span>
<span class="sd">            hue1 (np.array, optional): Array of hue values for the training dataset. Defaults to None.</span>
<span class="sd">            hue2 (np.array, optional): Array of hue values for the test or validation dataset. Defaults to None.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The method visualizes the geographical distribution of training and test/validation samples.</span>
<span class="sd">            - It uses scatter plots to represent the density of samples in different geographical areas.</span>
<span class="sd">            - The scatter plots are overlaid on top of a base map obtained from the specified shapefile URL.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gdf_actual_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_geopandas</span><span class="p">(</span><span class="n">y_true_train</span><span class="p">)</span>
        <span class="n">gdf_actual_val_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_geopandas</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

        <span class="c1"># Plot KDE as contour on the maps</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">gdf_y</span><span class="p">,</span> <span class="n">sizes</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
            <span class="p">[</span><span class="s2">&quot;Training Sample Density&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2"> Sample Density&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="n">gdf_actual_train</span><span class="p">,</span> <span class="n">gdf_actual_val_test</span><span class="p">],</span>
            <span class="p">[</span><span class="n">hue1</span><span class="p">,</span> <span class="n">hue2</span><span class="p">],</span>
        <span class="p">):</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Plot the basemap</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;State/ County Lines&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">gray_gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highlight_counties</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">basemap_highlights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">sizes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">gdf_y</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">gdf_y</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.markersize&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;darkorchid&quot;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">gdf_y</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">gdf_y</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.markersize&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">15</span><span class="p">,</span>
                    <span class="n">hue</span><span class="o">=</span><span class="n">sizes</span><span class="p">,</span>
                    <span class="n">size</span><span class="o">=</span><span class="n">sizes</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="s2">&quot;box&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Sample Weights (Color and Size)&quot;</span><span class="p">,</span>
                <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
                <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">),</span>
                <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_train_</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_sample_densities.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_geographic_error_distribution">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_geographic_error_distribution">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_geographic_error_distribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">actual_coords</span><span class="p">,</span>
        <span class="n">predicted_coords</span><span class="p">,</span>
        <span class="n">dataset</span><span class="p">,</span>
        <span class="n">buffer</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">marker_scale_factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">min_colorscale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">max_colorscale</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">n_contour_levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">centroids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the geographic distribution of prediction errors and uncertainties.</span>

<span class="sd">        This function calculates the Haversine error between actual and predicted coordinates and uses Gaussian Process Regression (GPR) to estimate error and uncertainty across a geographical area.</span>

<span class="sd">        Args:</span>
<span class="sd">            actual_coords (np.array): Array of actual geographical coordinates.</span>
<span class="sd">            predicted_coords (np.array): Array of predicted geographical coordinates.</span>
<span class="sd">            url (str): URL for the shapefile to plot geographical data.</span>
<span class="sd">            dataset (str): Name of the dataset being used.</span>
<span class="sd">            buffer (float, optional): Buffer distance for geographical plotting. Defaults to 0.1.</span>
<span class="sd">            marker_scale_factor (int, optional): Scale factor for marker size in plots. Defaults to 2.</span>
<span class="sd">            min_colorscale (int, optional): Minimum value for the color scale. Defaults to 0.</span>
<span class="sd">            max_colorscale (int, optional): Maximum value for the color scale. Defaults to 300.</span>
<span class="sd">            n_contour_levels (int, optional): Number of contour levels in the plot. Defaults to 20.</span>
<span class="sd">            centroids (np.array or geopandas.GeoDataFrame, optional): Array of centroids to be plotted. Defaults to None.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This method produces two subplots: one showing the spatial distribution of prediction errors and the others showing the uncertainty of these predictions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gdf_actual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_geopandas</span><span class="p">(</span><span class="n">actual_coords</span><span class="p">)</span>
        <span class="n">gdf_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_geopandas</span><span class="p">(</span><span class="n">predicted_coords</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">calculate_bounding_box</span><span class="p">(</span><span class="n">gdf_actual</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">centroids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gdf_centroids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_geopandas</span><span class="p">(</span><span class="n">centroids</span><span class="p">)</span>

        <span class="n">actual_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">gdf_actual</span><span class="p">)</span>
        <span class="n">predicted_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">gdf_pred</span><span class="p">)</span>

        <span class="n">haversine_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">haversine_distance</span><span class="p">(</span>
            <span class="n">actual_coords</span><span class="p">,</span> <span class="n">predicted_coords</span>
        <span class="p">)</span>

        <span class="c1"># Perform Kriging</span>
        <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span><span class="p">,</span> <span class="n">error_predictions</span><span class="p">,</span> <span class="n">error_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_kriging</span><span class="p">(</span>
            <span class="n">actual_coords</span><span class="p">,</span> <span class="n">haversine_errors</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">buffer</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">error_predictions</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">grid_x</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="n">error_predictions</span> <span class="o">=</span> <span class="n">error_predictions</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="p">(</span><span class="n">grid_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="c1"># if error_std.shape != grid_x.shape:</span>
        <span class="c1">#     error_std = error_std.reshape((grid_x.shape[0], grid_y.shape[0]))</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

        <span class="c1"># ax = [0]]</span>
        <span class="c1"># ax2 = axs[1]</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># ax2 = self._remove_spines(ax2)</span>

        <span class="c1"># Customization.</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_splines</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">)</span>
            <span class="c1"># ax2.set_xlabel(&quot;Latitude&quot;)</span>
            <span class="c1"># ax2.set_ylabel(&quot;Longitude&quot;)</span>

        <span class="c1"># Ensure correct scale and aspect ratio</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="s2">&quot;box&quot;</span><span class="p">)</span>
        <span class="c1"># ax2.set_aspect(&quot;equal&quot;, &quot;box&quot;)</span>

        <span class="k">def</span> <span class="nf">roundup</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">-=</span> <span class="n">x</span> <span class="o">%</span> <span class="o">-</span><span class="mi">100</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">roundup</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">haversine_errors</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">max_colorscale</span> <span class="o">-</span> <span class="mi">100</span>
            <span class="ow">and</span> <span class="n">max_colorscale</span> <span class="o">&gt;</span> <span class="mi">100</span>
        <span class="p">):</span>
            <span class="c1"># Round to nearest 100.</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">roundup</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">haversine_errors</span><span class="p">)),</span> <span class="n">max_colorscale</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">roundup</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">haversine_errors</span><span class="p">)),</span> <span class="n">max_colorscale</span><span class="p">)</span>
        <span class="c1"># vmax_std = min(roundup(np.max(error_std)), 100)</span>

        <span class="c1"># Define colormap and normalization</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;magma_r&quot;</span><span class="p">)</span>
        <span class="n">cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>  <span class="c1"># Set color for NaN values</span>
        <span class="c1"># uncertainty_cmap = plt.get_cmap(&quot;magma_r&quot;)</span>
        <span class="c1"># uncertainty_cmap.set_bad(uncertainty_cmap(0))  # Set color for NaN values</span>

        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">min_colorscale</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="c1"># norm_std = mcolors.Normalize(vmin=0, vmax=vmax_std)</span>

        <span class="n">contour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
            <span class="n">grid_x</span><span class="p">,</span>
            <span class="n">grid_y</span><span class="p">,</span>
            <span class="n">error_predictions</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
            <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="n">min_colorscale</span><span class="p">,</span>
                <span class="n">vmax</span><span class="p">,</span>
                <span class="n">num</span><span class="o">=</span><span class="n">n_contour_levels</span><span class="p">,</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">extend</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>  <span class="c1"># Include values beyond the defined range</span>
        <span class="p">)</span>

        <span class="c1"># uncert_contour = ax2.contourf(</span>
        <span class="c1">#     grid_x,</span>
        <span class="c1">#     grid_y,</span>
        <span class="c1">#     error_std,</span>
        <span class="c1">#     cmap=uncertainty_cmap,</span>
        <span class="c1">#     norm=norm_std,</span>
        <span class="c1">#     levels=np.linspace(</span>
        <span class="c1">#         0,</span>
        <span class="c1">#         vmax_std,</span>
        <span class="c1">#         num=n_contour_levels,</span>
        <span class="c1">#         endpoint=True,</span>
        <span class="c1">#     ),</span>
        <span class="c1">#     extend=&quot;both&quot;,  # Include values beyond the defined range</span>
        <span class="c1"># )</span>

        <span class="n">cbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_colorbar</span><span class="p">(</span>
            <span class="n">min_colorscale</span><span class="p">,</span>
            <span class="n">vmax</span><span class="p">,</span>
            <span class="n">n_contour_levels</span><span class="p">,</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">contour</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># uncert_cbar = self._make_colorbar(</span>
        <span class="c1">#     0,</span>
        <span class="c1">#     vmax_std,</span>
        <span class="c1">#     n_contour_levels,</span>
        <span class="c1">#     ax2,</span>
        <span class="c1">#     uncert_contour,</span>
        <span class="c1"># )</span>

        <span class="c1"># for i, a in enumerate([ax]):</span>
            <span class="c1"># Plot the basemap</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;State/ County Lines&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># if i == 0:</span>
        <span class="c1"># ax = a</span>
        <span class="c1"># else:</span>
        <span class="c1">#     ax2 = a</span>

        <span class="k">if</span> <span class="n">dataset</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;validation&quot;</span>

        <span class="c1"># Plot centroids layer.</span>
        <span class="k">if</span> <span class="n">centroids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_scatter_map</span><span class="p">(</span>
                <span class="n">dataset</span><span class="p">,</span>
                <span class="n">ax</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">gdf_centroids</span><span class="p">),</span>
                <span class="n">marker_scale_factor</span><span class="p">,</span>
                <span class="n">mult_factor</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Centroids&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Plot samples layer</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_scatter_map</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">actual_coords</span><span class="p">,</span> <span class="n">marker_scale_factor</span><span class="p">)</span>
        <span class="c1"># ax2 = self._plot_scatter_map(dataset, ax2, actual_coords, marker_scale_factor)</span>

        <span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">centroids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span>

        <span class="c1"># Add legend</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">)</span>

        <span class="n">cbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_cbar_fontsize</span><span class="p">(</span><span class="n">cbar</span><span class="p">)</span>
        <span class="c1"># uncert_cbar = self._set_cbar_fontsize(uncert_cbar)</span>

        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Prediction Error (km)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="c1"># uncert_cbar.ax.set_title(&quot;Interpolation Uncertainty\n&quot;, fontsize=self.fontsize)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_geographic_error_</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE._run_kriging">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE._run_kriging">[docs]</a>
    <span class="k">def</span> <span class="nf">_run_kriging</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">actual_coords</span><span class="p">,</span> <span class="n">haversine_errors</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">buffer</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs Ordinary Kriging on prediction errors to estimate error and uncertainty across a geographical area.</span>

<span class="sd">        This method uses Ordinary Kriging to interpolate prediction errors across a geographical area. It generates a grid of coordinates for interpolation and returns the interpolated error predictions and uncertainties.</span>

<span class="sd">        Args:</span>
<span class="sd">            actual_coords (np.array): Array of actual geographical coordinates.</span>
<span class="sd">            haversine_errors (np.array): Array of prediction errors.</span>
<span class="sd">            xmin (float): Minimum longitude value.</span>
<span class="sd">            ymin (float): Minimum latitude value.</span>
<span class="sd">            xmax (float): Maximum longitude value.</span>
<span class="sd">            ymax (float): Maximum latitude value.</span>
<span class="sd">            buffer (float): Buffer distance for geographical plotting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.array: Array of grid x-coordinates.</span>
<span class="sd">            np.array: Array of grid y-coordinates.</span>
<span class="sd">            np.array: Array of error predictions.</span>
<span class="sd">            np.array: Array of error standard deviations.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This method uses Ordinary Kriging to interpolate prediction errors across a geographical area.</span>
<span class="sd">            - It generates a grid of coordinates for interpolation and returns the interpolated error predictions and uncertainties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">actual_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">actual_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Create a grid for interpolation</span>
        <span class="n">grid_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span> <span class="o">-</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">+</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">grid_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span> <span class="o">-</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">+</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Perform Ordinary Kriging</span>
        <span class="n">OK</span> <span class="o">=</span> <span class="n">OrdinaryKriging</span><span class="p">(</span>
            <span class="n">lon</span><span class="p">,</span>
            <span class="n">lat</span><span class="p">,</span>
            <span class="n">haversine_errors</span><span class="p">,</span>
            <span class="n">variogram_model</span><span class="o">=</span><span class="s2">&quot;gaussian&quot;</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">enable_plotting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">coordinates_type</span><span class="o">=</span><span class="s2">&quot;geographic&quot;</span><span class="p">,</span>
            <span class="n">pseudo_inv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">z</span><span class="p">,</span> <span class="n">ss</span> <span class="o">=</span> <span class="n">OK</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">ss</span></div>


<div class="viewcode-block" id="PlotGenIE._set_cbar_fontsize">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE._set_cbar_fontsize">[docs]</a>
    <span class="k">def</span> <span class="nf">_set_cbar_fontsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbar</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the font size for the colorbar labels.</span>

<span class="sd">        Args:</span>
<span class="sd">            cbar (matplotlib.colorbar.Colorbar): The colorbar object whose font size is to be set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.colorbar.Colorbar: The colorbar object with updated font size.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This is a utility method for adjusting the appearance of colorbars in plots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cbar</span></div>


<div class="viewcode-block" id="PlotGenIE._plot_scatter_map">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE._plot_scatter_map">[docs]</a>
    <span class="k">def</span> <span class="nf">_plot_scatter_map</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataset</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">,</span>
        <span class="n">coords</span><span class="p">,</span>
        <span class="n">exp_factor</span><span class="p">,</span>
        <span class="n">mult_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Samples&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a scatter map of coordinates, with the size of each point representing a certain attribute (e.g., sample weight).</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset (str): Name of the dataset being used.</span>
<span class="sd">            ax (matplotlib.axes.Axes): The matplotlib Axes object for the plot.</span>
<span class="sd">            coords (np.array): Array of coordinates to be plotted.</span>
<span class="sd">            exp_factor (int): Exponent factor for scaling the size of the markers.</span>
<span class="sd">            mult_factor (float, optional): Multiplicative factor for marker size. Defaults to 1.0.</span>
<span class="sd">            label (str, optional): Label for the plotted points. Defaults to &quot;Samples&quot;.</span>
<span class="sd">            alpha (float, optional): Alpha transparency for the markers. Defaults to 0.5.</span>
<span class="sd">            color (str, optional): Color of the markers. Defaults to &quot;darkorchid&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.collections.PathCollection: The scatter plot object.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This method is used for creating scatter plots on geographical maps with customizable marker sizes and colors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.markersize&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="n">exp_factor</span> <span class="o">*</span> <span class="n">mult_factor</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2"> Set)&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE._make_colorbar">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE._make_colorbar">[docs]</a>
    <span class="k">def</span> <span class="nf">_make_colorbar</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">min_colorscale</span><span class="p">,</span> <span class="n">max_colorscale</span><span class="p">,</span> <span class="n">n_contour_levels</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">contour</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates and configures a colorbar for contour plots.</span>

<span class="sd">        This method generates a colorbar for contour plots with specified min and max values, and a defined number of levels.</span>

<span class="sd">        Args:</span>
<span class="sd">            min_colorscale (int): Minimum value for the color scale.</span>
<span class="sd">            max_colorscale (int): Maximum value for the color scale.</span>
<span class="sd">            n_contour_levels (int): Number of contour levels in the plot.</span>
<span class="sd">            ax (matplotlib.axes.Axes): The matplotlib Axes object for the plot.</span>
<span class="sd">            contour (matplotlib.contour.QuadContourSet): The contour plot object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.colorbar.Colorbar: The colorbar object.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This method sets up a colorbar with specified min and max values, and a defined number of levels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="n">min_colorscale</span><span class="p">,</span> <span class="n">max_colorscale</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">n_contour_levels</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                    <span class="n">min_colorscale</span><span class="p">,</span>
                    <span class="n">max_colorscale</span><span class="p">,</span>
                    <span class="n">num</span><span class="o">=</span><span class="n">n_contour_levels</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">cbar</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_cumulative_error_distribution">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_cumulative_error_distribution">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_cumulative_error_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">percentiles</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">mean</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate an ECDF plot for the given data.</span>

<span class="sd">        This method generates an Empirical Cumulative Distribution Function (ECDF) plot for the given data, with gradient fill based on the data values.</span>

<span class="sd">        Args:</span>
<span class="sd">            data (array-like): The dataset for which the ECDF is to be plotted. Should be a 1-D array of prediction errors.</span>
<span class="sd">            fn (str): Output filename.</span>
<span class="sd">            percentiles (np.ndarray): 25th, 50th, and 75th percentiles of errors. Will be of shape (3,).</span>
<span class="sd">            median (float): Median of prediction errors.</span>
<span class="sd">            mean (float): Mean of prediction errors.</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.figure.Figure: The ECDF plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Sort the data</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">roundup</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">-=</span> <span class="n">x</span> <span class="o">%</span> <span class="o">-</span><span class="mi">100</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

        <span class="c1"># Colormap and normalization</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">roundup</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="mi">150</span><span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;magma_r&quot;</span><span class="p">)</span>

        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>

        <span class="c1"># Create the plot</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;percent&quot;</span><span class="p">,</span>
            <span class="n">cumulative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Add Gradient Fill</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_kde_with_gradient</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Haversine Error (km)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Percent of Distribution&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Empirical Cumulative Distribution Function (ECDF)&quot;</span><span class="p">)</span>

        <span class="n">plist</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;25th&quot;</span><span class="p">,</span> <span class="s2">&quot;50th&quot;</span><span class="p">,</span> <span class="s2">&quot;75th&quot;</span><span class="p">]</span>
        <span class="n">clrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dodgerblue&quot;</span><span class="p">,</span> <span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="s2">&quot;darkorchid&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">perc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">percentiles</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
                    <span class="n">perc</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> Percentile&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">clrs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
                    <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mean&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightseagreen&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="n">median</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Median&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashdot&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">borderpad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotGenIE._fill_kde_with_gradient">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE._fill_kde_with_gradient">[docs]</a>
    <span class="k">def</span> <span class="nf">_fill_kde_with_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ydata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fill a KDE plot with a gradient following the X-axis values.</span>

<span class="sd">        Args:</span>
<span class="sd">            xdata (np.ndarray): X-axis values to plot.</span>
<span class="sd">            cmap (matplotlib.colors.cmap): Matplotlib colormap to use.</span>
<span class="sd">            norm (matplotlob.colors.Normalize): Normalizer for color gradient.</span>
<span class="sd">            ax (matplotlib.pyplot.Axes or None): Matplotlib axis to use. If ydata is None, then ax must be provided. Defaults to None.</span>
<span class="sd">            ydata (np.ndarray): Y-axis values to plot. If None, then gets the y-axis values from the provided `ax` object. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If ydata is None and ax is not provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ydata</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ax must be defined if ydata is None.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ax must be defined if ydata is None.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ydata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lines2d</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">obj</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">findobj</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;&lt;class &#39;matplotlib.lines.Line2D&#39;&gt;&quot;</span>
            <span class="p">]</span>
            <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span> <span class="o">=</span> <span class="n">lines2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="n">xdata</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
                <span class="n">ydata</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_zscores">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_zscores">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_zscores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot Z-score histogram for prediction errors.</span>

<span class="sd">        This method plots a histogram of Z-scores for prediction errors, with a gradient fill based on the Z-score values.</span>

<span class="sd">        Args:</span>
<span class="sd">            z (np.ndarray): Array of Z-scores.</span>
<span class="sd">            errors (np.ndarray): Array of prediction errors.</span>
<span class="sd">            fn (str): Filename for the output plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Purples&quot;</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
            <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;proportion&quot;</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">cumulative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="n">xdata</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
                <span class="n">ydata</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])),</span>
            <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Z-Scores&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Proportion&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Z-Score Distribution of Prediction Errors&quot;</span><span class="p">)</span>

        <span class="c1"># Annotations and Highlights</span>
        <span class="n">mean_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">mean_z</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mean&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_error_distribution">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_error_distribution">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_error_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the distribution of errors using a histogram, box plot, and Q-Q plot.</span>

<span class="sd">        Args:</span>
<span class="sd">            errors (np.array): An array of prediction errors.</span>
<span class="sd">            outfile (str): Output file path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">roundup</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">-=</span> <span class="n">x</span> <span class="o">%</span> <span class="o">-</span><span class="mi">100</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="n">vmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">roundup</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">errors</span><span class="p">)),</span> <span class="mi">150</span><span class="p">)</span>

        <span class="c1"># Colormap and normalization</span>
        <span class="c1"># cmap = plt.get_cmap(&quot;plasma_r&quot;)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;magma_r&quot;</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>

        <span class="c1"># Histogram (Density Plot with Gradient)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Compute KDE</span>
        <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span> <span class="mi">150</span><span class="p">)</span>
        <span class="n">kde_values</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span>

        <span class="c1"># Create Line Plot for the KDE</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">kde_values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

        <span class="c1"># Add Gradient Fill</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_kde_with_gradient</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">ydata</span><span class="o">=</span><span class="n">kde_values</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Prediction Error x Sampling Density&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Haversine Error (km)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Sampling Density&quot;</span><span class="p">)</span>

        <span class="c1"># Box Plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">bplot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
            <span class="n">errors</span><span class="p">,</span>
            <span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">notch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">bootstrap</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">patch_artist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">showfliers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Prediction Error Box Plot&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Haversine Error (km)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">patch</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bplot</span><span class="p">[</span><span class="s2">&quot;boxes&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;darkorchid&quot;</span><span class="p">]):</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

        <span class="c1"># Q-Q Plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plt</span><span class="p">,</span> <span class="n">rvalue</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Quantile x Quantile Error&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Theoretical Quantiles&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Actual Quantiles&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="p">)</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE.polynomial_regression_plot">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.polynomial_regression_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">polynomial_regression_plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">actual_coords</span><span class="p">,</span>
        <span class="n">predicted_coords</span><span class="p">,</span>
        <span class="n">dataset</span><span class="p">,</span>
        <span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
        <span class="n">max_ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">n_xticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a polynomial regression plot with the specified degree.</span>

<span class="sd">        Args:</span>
<span class="sd">            actual_coords (np.array): Array of actual geographical coordinates.</span>
<span class="sd">            predicted_coords (np.array): Array of predicted geographical coordinates by the model.</span>
<span class="sd">            dataset (str): Specifies the dataset being used, should be either &#39;test&#39; or &#39;validation&#39;.</span>
<span class="sd">            degree (int): Polynomial degree to fit. Defaults to 3.</span>
<span class="sd">            dtype (torch.dtype): PyTorch data type to use. Defaults to torch.float32.</span>
<span class="sd">            max_ylim (int): Maximum y-axis (prediction error) value to plot. Defaults to None (don&#39;t adjust y-axis limits). Defaults to None.</span>
<span class="sd">            max_xlim (float): Maximum X-axis (sample density) value to plot. Defaults to None (don&#39;t adjust x-axis limits). Defaults to None.</span>
<span class="sd">            n_xticks (int): Number of major X-axis ticks to use. Only applied if max_xlim is not None. Defaults to 5.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the dataset parameter is not &#39;test&#39; or does not start with &#39;val&#39;.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This function calculates the Haversine error for each pair of actual and predicted coordinates.</span>
<span class="sd">            - It then computes the KDE values for these errors and plots a regression to analyze the relationship.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">dataset</span> <span class="o">!=</span> <span class="s2">&quot;test&quot;</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">dataset</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">dataset</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span>
        <span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;dataset&#39; parameter must be either &#39;test&#39; or &#39;validation&#39;: </span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">gdf_actual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_geopandas</span><span class="p">(</span><span class="n">actual_coords</span><span class="p">)</span>
        <span class="n">gdf_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_geopandas</span><span class="p">(</span><span class="n">predicted_coords</span><span class="p">)</span>

        <span class="c1"># Project to UTM zone (adjust the zone number as per the location)</span>
        <span class="c1"># Arkansas is generally in UTM zone 15N</span>
        <span class="n">gdf_basemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">gdf_basemap</span> <span class="o">=</span> <span class="n">gdf_basemap</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">32615</span><span class="p">)</span>

        <span class="c1"># Calculate area in square meters and convert to square kilometers</span>
        <span class="n">gdf_basemap</span><span class="p">[</span><span class="s2">&quot;Area_km2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">gdf_basemap</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="mf">1e6</span>
        <span class="p">)</span>  <span class="c1"># convert sq meters to sq km</span>

        <span class="n">sampler</span> <span class="o">=</span> <span class="n">GeographicDensitySampler</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">gdf_actual</span><span class="p">),</span>
            <span class="n">use_kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">use_kmeans</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">max_clusters</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">max_neighbors</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">density</span>

        <span class="c1"># Calculate Haversine error for each pair of points</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">haversine_distance</span><span class="p">(</span><span class="n">gdf_actual</span><span class="p">,</span> <span class="n">gdf_pred</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

        <span class="c1"># Create polynomial features</span>
        <span class="n">poly_model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="p">),</span> <span class="n">LinearRegression</span><span class="p">())</span>

        <span class="c1"># Fit to data</span>
        <span class="n">poly_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># Generate predictions for plotting</span>
        <span class="n">xfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">yfit</span> <span class="o">=</span> <span class="n">poly_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xfit</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>

        <span class="n">r</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="s2">&quot;&lt; 0.0001&quot;</span>
        <span class="k">elif</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="s2">&quot;&lt; 0.001&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;= </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">xfit</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">yfit</span><span class="p">,</span>
            <span class="n">fit_reg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">n_boot</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;darkorchid&quot;</span><span class="p">},</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Pearson&#39;s R = </span><span class="si">{</span><span class="n">r</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">P-value </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">kneedle</span> <span class="o">=</span> <span class="n">KneeLocator</span><span class="p">(</span>
            <span class="n">xfit</span><span class="p">,</span>
            <span class="n">yfit</span><span class="p">,</span>
            <span class="n">curve</span><span class="o">=</span><span class="s2">&quot;convex&quot;</span><span class="p">,</span>
            <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;decreasing&quot;</span><span class="p">,</span>
            <span class="n">interp_method</span><span class="o">=</span><span class="s2">&quot;polynomial&quot;</span><span class="p">,</span>
            <span class="n">polynomial_degree</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">opt_samp_density</span> <span class="o">=</span> <span class="n">kneedle</span><span class="o">.</span><span class="n">knee</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimal sampling density: </span><span class="si">{</span><span class="n">opt_samp_density</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate total area</span>
        <span class="n">total_area_km2</span> <span class="o">=</span> <span class="n">gdf_basemap</span><span class="p">[</span><span class="s2">&quot;Area_km2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># Calculate proportional sampling density</span>
        <span class="n">proportional_density</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual_coords</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_area_km2</span>

        <span class="n">gdf_basemap</span><span class="p">[</span><span class="s2">&quot;Required_Samples&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">gdf_basemap</span><span class="p">[</span><span class="s2">&quot;Area_km2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">proportional_density</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">calculate_95_ci</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Calculate the 95% confidence interval for a given column in a pandas DataFrame.</span>

<span class="sd">            Args:</span>
<span class="sd">                dataframe (pd.DataFrame): The input DataFrame.</span>
<span class="sd">                column_name (str): The name of the column for which to calculate the 95% CI.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tuple: A tuple containing the lower and upper bounds of the 95% CI.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">column_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2"> not found in DataFrame.&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>  <span class="c1"># Drop missing values</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">sem</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">sem</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># Standard error of the mean</span>
            <span class="n">margin_of_error</span> <span class="o">=</span> <span class="n">sem</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">)</span>  <span class="c1"># 95% confidence level</span>

            <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">-</span> <span class="n">margin_of_error</span>
            <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">+</span> <span class="n">margin_of_error</span>

            <span class="k">return</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span>

        <span class="n">mean_samples_per_county</span> <span class="o">=</span> <span class="n">gdf_basemap</span><span class="p">[</span><span class="s2">&quot;Required_Samples&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">lower_95ci</span><span class="p">,</span> <span class="n">upper_95ci</span> <span class="o">=</span> <span class="n">calculate_95_ci</span><span class="p">(</span><span class="n">gdf_basemap</span><span class="p">,</span> <span class="s2">&quot;Required_Samples&quot;</span><span class="p">)</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="s2">&quot;validation&quot;</span> <span class="k">if</span> <span class="n">dataset</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span> <span class="k">else</span> <span class="n">dataset</span>

        <span class="c1"># Plotting the results</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightseagreen&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ds</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2"> Set Samples&quot;</span><span class="p">,</span>
            <span class="n">s</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.markersize&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">edgecolors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="n">opt_samp_density</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Optimal Sample Density = </span><span class="si">{</span><span class="n">opt_samp_density</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Mean Samples / County: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_samples_per_county</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;95% CI: </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">lower_95ci</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">upper_95ci</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">roundup</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">-=</span> <span class="n">x</span> <span class="o">%</span> <span class="o">-</span><span class="mi">100</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="k">if</span> <span class="n">max_ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">roundup</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">max_ylim</span> <span class="o">-</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">max_ylim</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="c1"># Round to nearest 100.</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">roundup</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">max_ylim</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">roundup</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">max_ylim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">max_xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_xlim</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">max_xlim</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">max_xlim</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;max_xlim could not be coerced to type float. Value must be numeric, but got: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">max_xlim</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_xlim</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_xlim</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">n_xticks</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Prediction Error (km)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Sample Density (Samples / $km^2$)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_kde_error_regression_</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_mca_curve">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_mca_curve">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_mca_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">explained_inertia</span><span class="p">,</span> <span class="n">optimal_n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the cumulative explained inertia as a function of the number of components in Multiple Correspondence Analysis (MCA).</span>

<span class="sd">        This plot is useful for determining the optimal number of components to retain in MCA.</span>

<span class="sd">        Args:</span>
<span class="sd">            explained_inertia (array-like): An array of cumulative explained inertia for each number of components.</span>
<span class="sd">            optimal_n (int): The optimal number of components determined for MCA.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The plot displays the explained inertia against the number of components.</span>
<span class="sd">            - A vertical line indicates the selected optimal number of components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Function implementation...</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_inertia</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">explained_inertia</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="s2">&quot;darkorchid&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of Components&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Explained Inertia&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;MCA Explained Inertia&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">optimal_n</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_mca_curve.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_nmf_error">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_nmf_error">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_nmf_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">opt_n_components</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the reconstruction error as a function of the number of components in Non-negative Matrix Factorization (NMF).</span>

<span class="sd">        This plot can be used to select the optimal number of components for NMF by identifying the point where additional components do not significantly decrease the error.</span>

<span class="sd">        Args:</span>
<span class="sd">            errors (list): A list of NMF reconstruction errors for each number of components.</span>
<span class="sd">            opt_n_components (int): The optimal number of components selected for NMF.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The plot visualizes how the reconstruction error changes with the number of NMF components.</span>
<span class="sd">            - A vertical line indicates the selected optimal number of NMF components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorchid&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;NMF Components&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;NMF Reconstruction Error&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">opt_n_components</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Selected Number of NMF Components&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;NMF Components vs. Reconstruction Error&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_nmf_curve.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_pca_curve">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_pca_curve">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_pca_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">vr</span><span class="p">,</span> <span class="n">knee</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the cumulative explained variance as a function of the number of principal components in Principal Component Analysis (PCA).</span>

<span class="sd">        This plot is helpful for determining the number of components to retain in PCA.</span>

<span class="sd">        Args:</span>
<span class="sd">            x (array-like): An array representing the number of principal components.</span>
<span class="sd">            vr (array-like): An array of cumulative explained variance ratios for each number of components.</span>
<span class="sd">            knee (int): The &#39;knee&#39; point, or the optimal number of components to retain in PCA.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The plot shows the cumulative explained variance against the number of principal components.</span>
<span class="sd">            - A vertical line at the &#39;knee&#39; point helps in visually identifying the optimal number of components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">vr</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorchid&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of Principal Components&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Explained Variance&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">knee</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Selected Number of Components&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Principal Components vs. Explained Variance&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_pca_curve.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_outliers">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_outliers">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_outliers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">y_true</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a scatter plot to visualize identified outliers.</span>

<span class="sd">        This method plots the geographical coordinates of the data points, highlighting the outliers in a different color and size.</span>

<span class="sd">        Args:</span>
<span class="sd">            mask (np.array): A boolean array where &#39;True&#39; indicates an outlier.</span>
<span class="sd">            y_true (np.array): Array of actual coordinates.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The function visualizes outliers on a geographical map, aiding in the identification of anomalous data points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Ensure correct CRS.</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_geopandas</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Outliers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">mask</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Outliers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Outliers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Sizes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Non-Outlier&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Outliers&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;Sizes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Outlier&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

        <span class="c1"># Plot the basemap</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;State/ County Lines&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap_highlights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gray_gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highlight_counties</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">basemap_highlights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
            <span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Outliers&quot;</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="s2">&quot;Sizes&quot;</span><span class="p">,</span>
            <span class="n">sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
            <span class="n">size_order</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Non-Outlier&quot;</span><span class="p">,</span> <span class="s2">&quot;Outlier&quot;</span><span class="p">],</span>
            <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set2&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Outliers Removed from Dataset&quot;</span><span class="p">)</span>

        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span>
            <span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend_</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Outlier Status&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_outlier_scatterplot.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_gamma_distribution">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_gamma_distribution">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_gamma_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">Dg</span><span class="p">,</span> <span class="n">sig_level</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">plot_main</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the gamma distribution.</span>

<span class="sd">        This method plots the gamma distribution with the given shape and scale parameters and highlights the critical value for the given significance level.</span>

<span class="sd">        Args:</span>
<span class="sd">            shape (float): Shape parameter of the gamma distribution.</span>
<span class="sd">            scale (float): Scale parameter of the gamma distribution.</span>
<span class="sd">            Dg (np.array): Dg statistic for each sample.</span>
<span class="sd">            sig_level (float): Significance level (e.g., 0.05).</span>
<span class="sd">            filename (str): Name of the file to save the plot.</span>
<span class="sd">            plot_main (str): Title of the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Dg</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>

        <span class="n">gamma_threshold</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sig_level</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">gamma_threshold</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;P = </span><span class="si">{</span><span class="n">sig_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gamma(α=</span><span class="si">{</span><span class="n">shape</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, β=</span><span class="si">{</span><span class="n">scale</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">plot_main</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pth</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_sample_with_density">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_sample_with_density">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_sample_with_density</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">sample_id</span><span class="p">,</span> <span class="n">df_known</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gray_counties</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to plot a sample with density contours.</span>

<span class="sd">        This method calculates the density contours using KDE and plots them on a map.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): DataFrame containing the sample data.</span>
<span class="sd">            sample_id (str): Sample ID.</span>
<span class="sd">            df_known (pd.DataFrame, optional): DataFrame containing known data. Defaults to None.</span>
<span class="sd">            dataset (str, optional): Name of the dataset. Defaults to None.</span>
<span class="sd">            gray_counties (list, optional): List of counties to highlight in gray. Defaults to</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If the dataset argument is NoneType.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;dataset argument cannot be NoneType.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_geopandas</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df_known</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gdf_known</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_geopandas</span><span class="p">(</span><span class="n">df_known</span><span class="p">)</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">calculate_bounding_box</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>

        <span class="c1"># Calculate density contours using KDE</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
        <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span> <span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">:</span><span class="mi">100</span><span class="n">j</span><span class="p">]</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
        <span class="n">zz</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># Determine density levels</span>
        <span class="n">z_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">zz</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">cumulative_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">z_sorted</span><span class="p">)</span>
        <span class="n">total_z</span> <span class="o">=</span> <span class="n">cumulative_z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">level_50</span> <span class="o">=</span> <span class="n">z_sorted</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cumulative_z</span><span class="p">,</span> <span class="mf">0.50</span> <span class="o">*</span> <span class="n">total_z</span><span class="p">)]</span>
        <span class="n">level_70</span> <span class="o">=</span> <span class="n">z_sorted</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cumulative_z</span><span class="p">,</span> <span class="mf">0.70</span> <span class="o">*</span> <span class="n">total_z</span><span class="p">)]</span>
        <span class="n">level_90</span> <span class="o">=</span> <span class="n">z_sorted</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cumulative_z</span><span class="p">,</span> <span class="mf">0.90</span> <span class="o">*</span> <span class="n">total_z</span><span class="p">)]</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">level_50</span><span class="p">,</span> <span class="n">level_70</span><span class="p">,</span> <span class="n">level_90</span><span class="p">])</span>

        <span class="c1"># Debug prints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Bootstrap Contour Density Levels: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;50% -&gt; </span><span class="si">{</span><span class="n">level_50</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;70% -&gt; </span><span class="si">{</span><span class="n">level_70</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;90% -&gt; </span><span class="si">{</span><span class="n">level_90</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="c1"># Plot density contours</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#E69F00&quot;</span><span class="p">,</span> <span class="s2">&quot;#56B4E9&quot;</span><span class="p">,</span> <span class="s2">&quot;#CC79A7&quot;</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>

        <span class="c1"># Additional plot for KDE visualization</span>
        <span class="n">fig_kde</span><span class="p">,</span> <span class="n">ax_kde</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ax_kde</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
        <span class="n">fig_kde</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_kde</span><span class="p">)</span>
        <span class="n">ax_kde</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;KDE Density Plot&quot;</span><span class="p">)</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_kde_contours_</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">sample_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;kde_contour_plots&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">/</span> <span class="n">fn</span>
        <span class="n">outdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig_kde</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

        <span class="c1"># Create custom legend for the contours</span>
        <span class="n">contour_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">]</span>

        <span class="n">grays</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;darkgrey&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)]</span>

        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df_known</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gdf_known</span> <span class="o">=</span> <span class="n">gdf_known</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="p">)</span>

        <span class="c1"># Plot the basemap</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;State/ County Lines&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">gray_counties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_highlight_counties</span><span class="p">(</span><span class="n">gray_counties</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;90% Density&quot;</span><span class="p">,</span> <span class="s2">&quot;70% Density&quot;</span><span class="p">,</span> <span class="s2">&quot;50% Density&quot;</span><span class="p">]</span>

        <span class="c1"># Plot bootstrapped points with reduced opacity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicted Points&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="c1"># Plot mean point</span>
        <span class="n">mean_lat</span><span class="p">,</span> <span class="n">mean_lon</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">gdf</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">x</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">mean_lon</span><span class="p">,</span> <span class="n">mean_lat</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicted Locality&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Plot known points</span>
        <span class="k">if</span> <span class="n">df_known</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">df_known</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mean_known_lat</span><span class="p">,</span> <span class="n">mean_known_lon</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">gdf_known</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">gdf_known</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mean_known_lat</span><span class="p">,</span> <span class="n">mean_known_lon</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">gdf_known</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">gdf_known</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">mean_known_lon</span><span class="p">,</span>
                <span class="n">mean_known_lat</span><span class="p">,</span>
                <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Recorded Locality&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sample_id</span><span class="si">}</span><span class="s2">: Bootstrapped Locality Predictions&quot;</span><span class="p">)</span>

        <span class="n">handles</span><span class="p">,</span> <span class="n">labs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">contour_lines</span> <span class="o">+=</span> <span class="n">handles</span> <span class="o">+</span> <span class="n">grays</span>
        <span class="n">labels</span> <span class="o">+=</span> <span class="n">labs</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;CWD Mgmt Zone&quot;</span><span class="p">]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">contour_lines</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="s2">&quot;box&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_bootstrap_ci_plot_</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">sample_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;bootstrapped_sample_ci&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">/</span> <span class="n">fn</span>
        <span class="n">outdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE._highlight_counties">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE._highlight_counties">[docs]</a>
    <span class="k">def</span> <span class="nf">_highlight_counties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gray_counties</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Highlight specific counties in the basemap.</span>

<span class="sd">        Args:</span>
<span class="sd">            gray_counties (list): List of counties to highlight.</span>
<span class="sd">            gdf (geopandas.GeoDataFrame): GeoDataFrame of the basemap.</span>
<span class="sd">            ax (matplotlib.pyplot.Axes): Matplotlib axis to use. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            geopandas.GeoDataFrame: GeoDataFrame of the highlighted counties.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This method highlights specific counties in the basemap by coloring them gray.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gray_counties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gray_counties</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">gray_counties</span> <span class="o">=</span> <span class="n">gray_counties</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;NAME&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Cannot highlight basemap counties. Attribute &#39;Name&#39; not in provided basemap shapefile: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="c1"># Filtering the counties to be colored gray</span>
            <span class="n">gray_county_gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;NAME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">gray_counties</span><span class="p">)]</span>
            <span class="n">gray_county_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">gray_county_gdf</span>
        <span class="k">return</span> <span class="n">gdf</span></div>


<div class="viewcode-block" id="PlotGenIE.visualize_oversample_clusters">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.visualize_oversample_clusters">[docs]</a>
    <span class="k">def</span> <span class="nf">visualize_oversample_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">cluster_labels</span><span class="p">,</span> <span class="n">sample_origin_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize the genotypes and their clusters in a 2D scatter plot.</span>

<span class="sd">        This method plots the genotypes and their clusters in a 2D scatter plot, coloring the points by cluster and shape by sample origin.</span>

<span class="sd">        Args:</span>
<span class="sd">            arr (np.ndarray): Array to use for clustering.</span>
<span class="sd">            cluster_labels (np.ndarray): Cluster labels to use.</span>
<span class="sd">            sample_origin_list: (list): List of sample origins (synthetic versus original).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

        <span class="n">cluster_sizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">cluster_labels</span><span class="p">)</span>
        <span class="n">n_bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cluster_labels</span><span class="p">))</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">sample_origin_list</span> <span class="o">==</span> <span class="s2">&quot;synthetic&quot;</span>
        <span class="n">cluster_sizes</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">100</span>
        <span class="n">cluster_sizes</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">50</span>

        <span class="c1"># Get a geopandas GeoDataFrame.</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">to_geopandas</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

        <span class="c1"># Plot the basemap</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;State/ County Lines&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap_highlights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gray_gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highlight_counties</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">basemap_highlights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basemap</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
            <span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="n">cluster_labels</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">sample_origin_list</span><span class="p">,</span>
            <span class="n">style_order</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;original&quot;</span><span class="p">,</span> <span class="s2">&quot;synthetic&quot;</span><span class="p">],</span>
            <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set2&quot;</span><span class="p">,</span>
            <span class="n">s</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_spines</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Oversampling Groups&quot;</span><span class="p">)</span>

        <span class="n">h</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>

        <span class="c1"># Exclude first n_bins labels.</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">h</span><span class="p">[</span><span class="n">n_bins</span><span class="p">:],</span>
            <span class="n">l</span><span class="p">[</span><span class="n">n_bins</span><span class="p">:],</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend_</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Sample Origin&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_coords_train_clusters_oversampled.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotGenIE.plot_data_distributions">
<a class="viewcode-back" href="../../../geogenie.plotting.html#geogenie.plotting.plotting.PlotGenIE.plot_data_distributions">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_data_distributions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">is_target</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the distributions of the train, validation, and test datasets.</span>

<span class="sd">        Args:</span>
<span class="sd">            train (np.ndarray): Training dataset.</span>
<span class="sd">            val (np.ndarray): Validation dataset.</span>
<span class="sd">            test (np.ndarray): Test dataset.</span>
<span class="sd">            is_target (bool, optional): Whether the data is a target. Defaults to False.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the data is not a target and the shape of the arrays is not the same.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This method plots the distributions of the train, validation, and test datasets.</span>
<span class="sd">            - If the data is a target, the method plots the distributions of the longitude and latitude values.</span>
<span class="sd">            - If the data is not a target, the method plots the distributions of the genotypes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">is_target</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Split Target Distributions&quot;</span><span class="p">)</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Lon&quot;</span><span class="p">,</span> <span class="s2">&quot;Lat&quot;</span><span class="p">])</span>
            <span class="n">train</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Lon&quot;</span><span class="p">,</span> <span class="s2">&quot;Lat&quot;</span><span class="p">])</span>
            <span class="n">val</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Lon&quot;</span><span class="p">,</span> <span class="s2">&quot;Lat&quot;</span><span class="p">])</span>
            <span class="n">test</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span><span class="p">])</span>
            <span class="n">df_melt</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">])</span>
            <span class="n">df_melt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_melt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">df_lon</span> <span class="o">=</span> <span class="n">df_melt</span><span class="p">[</span><span class="n">df_melt</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Lon&quot;</span><span class="p">]</span>
            <span class="n">df_lat</span> <span class="o">=</span> <span class="n">df_melt</span><span class="p">[</span><span class="n">df_melt</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Lat&quot;</span><span class="p">]</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">df_lon</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set2&quot;</span><span class="p">,</span>
                <span class="n">multiple</span><span class="o">=</span><span class="s2">&quot;dodge&quot;</span><span class="p">,</span>
                <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>

            <span class="n">ax2</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">df_lat</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set2&quot;</span><span class="p">,</span>
                <span class="n">multiple</span><span class="o">=</span><span class="s2">&quot;dodge&quot;</span><span class="p">,</span>
                <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
            <span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Train&quot;</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Val&quot;</span><span class="p">)</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test</span>

            <span class="n">df_melt</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">melt</span><span class="p">()</span>
            <span class="n">df_melt</span> <span class="o">=</span> <span class="n">df_melt</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
            <span class="n">df_melt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_melt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int8&quot;</span><span class="p">)</span>
            <span class="n">df_melt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_melt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="n">df_melt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GT&quot;</span> <span class="o">+</span> <span class="n">df_melt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">df_melt</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
                <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set2&quot;</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Split Feature Distributions&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Genotypes&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_target</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_target_dataset_distributions.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_feature_dataset_distributions.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pfx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the prefix for the output files.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>

    <span class="nd">@pfx</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pfx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the prefix for the output files.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">outdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the output directory for the files.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>

    <span class="nd">@outdir</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">outdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the output directory for the files.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">obp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the output base path for the files.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span>

    <span class="nd">@obp</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">obp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the output base path for the files.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outbasepath</span> <span class="o">=</span> <span class="n">value</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Bradley T. Martin and Tyler K. Chafin.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>